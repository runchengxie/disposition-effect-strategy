# 处置效应增强型盈利动量策略

本仓库包含一个基于国信证券研报《行为金融系列二：处置效应与信息未充分反应参与定价》的量化交易策略核心逻辑的 Python 实现。

## 策略概述

该策略旨在利用“处置效应”，即投资者倾向于过早卖出盈利股票（止盈）而过久持有亏损股票（止损）。这种行为可能导致股价对盈利消息反应不足，尤其是当消息与投资者现有的未实现盈亏状态一致时。

- **做多信号：** 具有高正面盈利意外（高 SUE）且投资者已有未实现收益（高 CGO/RCGO）的股票。预期是获利了结的卖压抑制了最初的上涨，导致持续的向上漂移。
- **做空信号：** 具有高负面盈利意外（低 SUE）且投资者已有未实现亏损（低 CGO/RCGO）的股票。预期是不愿实现亏损延迟了价格下跌，导致持续的向下漂移。

## 使用的因子（简化实现）

1.  **SUE (标准化未预期盈余):** 衡量盈利意外。
    *   *研报方法:* 季节性随机游走模型。
    *   *本实现 (简化):* 最新报告的季度每股收益 (EPS) 的同比变化。**注意：** 这是一个显著的简化。
2.  **CGO (资本利得悬置):** 衡量平均未实现盈亏。
    *   *研报方法:* `(当前价格 - 估计平均成本) / 当前价格`，使用历史价格/成交量（例如，500天）。研报更倾向于使用 **RCGO**（在控制其他因子后的残差 CGO）。
    *   *本实现:* 基于回溯期（默认为500天）内的成交量加权平均价 (VWAP) 计算 CGO。**注意：** 由于复杂性，此处未实现 RCGO。

## 实现细节

- **股票池:** 沪深800成分股（占位符函数 `get_csi800_constituents`）。
- **频率:** 设计为月度再平衡（但脚本仅针对单个日期运行）。
- **排序:** 根据 SUE 和 CGO 将股票独立排序分为五分位数（5组）。
- **投资组合构建:**
    - **多头组合:** SUE 最高 20% 分位数 且 CGO 最高 20% 分位数的股票。
    - **空头组合:** SUE 最低 20% 分位数 且 CGO 最低 20% 分位数的股票。
- **权重:** 假设组合内等权重（本脚本未明确计算）。
- **持有期:** 研报建议 2-3 个月。本脚本识别 *一个* 再平衡日期的股票。完整的历史回测需要管理重叠的投资组合。

## 如何使用

1.  **安装依赖:**
    ```bash
    pip install -r requirements.txt
    ```
2.  **替换数据占位符:** 修改 `strategy.py` 中的 `get_csi800_constituents`、`get_price_volume_data` 和 `get_earnings_data` 函数，以从您选择的 A 股数据提供商获取数据。确保返回的数据符合预期的 pandas DataFrame 格式。
3.  **运行脚本:**
    ```bash
    python strategy.py
    ```
    这将打印指定 `rebalance_date` 的多头和空头股票列表。

## 局限性与潜在改进

- **数据源:** 需要可靠的中国 A 股历史价格/成交量、成分股和基本面（盈利）数据源。
- **因子简化:** 使用了简化的 SUE 和 CGO。实现研报中精确的 SUE（季节性随机游走）和 RCGO（残差 CGO）可能会提高准确性，但会显著增加复杂性。
- **无回测:** 此脚本仅执行单个日期的投资组合选择。需要一个适当的回测框架来评估历史表现，包括交易成本、滑点以及处理持有期内的重叠投资组合。
- **参数调优:** CGO 的回溯期（500天）和使用五分位数（20%）是基于研报的，但可以进行优化。
- **错误处理:** 包含的错误处理非常有限。

## 免责声明

此代码仅用于教育目的，展示了所述策略的核心逻辑。它不是财务建议。交易金融工具涉及重大风险。请自行承担使用此代码的风险，并在部署任何资金之前确保您理解基础策略及其局限性。

